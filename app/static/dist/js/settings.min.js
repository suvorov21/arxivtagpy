var allCatsArray={"astro-ph.CO":"Cosmology and Nongalactic Astrophysics","astro-ph.EP":"Earth and Planetary Astrophysics","astro-ph.GA":"Astrophysics of Galaxies","astro-ph.HE":"High Energy Astrophysical Phenomena","astro-ph.IM":"Instrumentation and Methods for Astrophysics","astro-ph.SR":"Solar and Stellar Astrophysics","cond-mat.dis-nn":"Disordered Systems and Neural Networks","cond-mat.mes-hall":"Mesoscale and Nanoscale Physics","cond-mat.mtrl-sci":"Materials Science","cond-mat.other":"Other Condensed Matter","cond-mat.quant-gas":"Quantum Gases","cond-mat.soft":"Soft Condensed Matter","cond-mat.stat-mech":"Statistical Mechanics","cond-mat.str-el":"Strongly Correlated Electrons","cond-mat.supr-con":"Superconductivity","cs.AI":"Artificial Intelligence","cs.AR":"Hardware Architecture","cs.CC":"Computational Complexity","cs.CE":"Computational Engineering, Finance, and Science","cs.CG":"Computational Geometry","cs.CL":"Computation and Language","cs.CR":"Cryptography and Security","cs.CV":"Computer Vision and Pattern Recognition","cs.CY":"Computers and Society","cs.DB":"Databases","cs.DC":"Distributed, Parallel, and Cluster Computing","cs.DL":"Digital Libraries","cs.DM":"Discrete Mathematics","cs.DS":"Data Structures and Algorithms","cs.ET":"Emerging Technologies","cs.FL":"Formal Languages and Automata Theory","cs.GL":"General Literature","cs.GR":"Graphics","cs.GT":"Computer Science and Game Theory","cs.HC":"Human-Computer Interaction","cs.IR":"Information Retrieval","cs.IT":"Information Theory","cs.LG":"Learning","cs.LO":"Logic in Computer Science","cs.MA":"Multiagent Systems","cs.MM":"Multimedia","cs.MS":"Mathematical Software","cs.NA":"Numerical Analysis","cs.NE":"Neural and Evolutionary Computing","cs.NI":"Networking and Internet Architecture","cs.OH":"Other Computer Science","cs.OS":"Operating Systems","cs.PF":"Performance","cs.PL":"Programming Languages","cs.RO":"Robotics","cs.SC":"Symbolic Computation","cs.SD":"Sound","cs.SE":"Software Engineering","cs.SI":"Social and Information Networks","cs.SY":"Systems and Control","econ.EM":"Econometrics","eess.AS":"Audio and Speech Processing","eess.IV":"Image and Video Processing","eess.SP":"Signal Processing","gr-qc":"General Relativity and Quantum Cosmology","hep-ex":"High Energy Physics - Experiment","hep-lat":"High Energy Physics - Lattice","hep-ph":"High Energy Physics - Phenomenology","hep-th":"High Energy Physics - Theory","math.AC":"Commutative Algebra","math.AG":"Algebraic Geometry","math.AP":"Analysis of PDEs","math.AT":"Algebraic Topology","math.CA":"Classical Analysis and ODEs","math.CO":"Combinatorics","math.CT":"Category Theory","math.CV":"Complex Variables","math.DG":"Differential Geometry","math.DS":"Dynamical Systems","math.FA":"Functional Analysis","math.GM":"General Mathematics","math.GN":"General Topology","math.GR":"Group Theory","math.GT":"Geometric Topology","math.HO":"History and Overview","math.IT":"Information Theory","math.KT":"K-Theory and Homology","math.LO":"Logic","math.MG":"Metric Geometry","math.MP":"Mathematical Physics","math.NA":"Numerical Analysis","math.NT":"Number Theory","math.OA":"Operator Algebras","math.OC":"Optimization and Control","math.PR":"Probability","math.QA":"Quantum Algebra","math.RA":"Rings and Algebras","math.RT":"Representation Theory","math.SG":"Symplectic Geometry","math.SP":"Spectral Theory","math.ST":"Statistics Theory","math-ph":"Mathematical Physics","nlin.AO":"Adaptation and Self-Organizing Systems","nlin.CD":"Chaotic Dynamics","nlin.CG":"Cellular Automata and Lattice Gases","nlin.PS":"Pattern Formation and Solitons","nlin.SI":"Exactly Solvable and Integrable Systems","nucl-ex":"Nuclear Experiment","nucl-th":"Nuclear Theory","physics.acc-ph":"Accelerator Physics","physics.ao-ph":"Atmospheric and Oceanic Physics","physics.app-ph":"Applied Physics","physics.atm-clus":"Atomic and Molecular Clusters","physics.atom-ph":"Atomic Physics","physics.bio-ph":"Biological Physics","physics.chem-ph":"Chemical Physics","physics.class-ph":"Classical Physics","physics.comp-ph":"Computational Physics","physics.data-an":"Data Analysis, Statistics and Probability","physics.ed-ph":"Physics Education","physics.flu-dyn":"Fluid Dynamics","physics.gen-ph":"General Physics","physics.geo-ph":"Geophysics","physics.hist-ph":"History and Philosophy of Physics","physics.ins-det":"Instrumentation and Detectors","physics.med-ph":"Medical Physics","physics.optics":"Optics","physics.plasm-ph":"Plasma Physics","physics.pop-ph":"Popular Physics","physics.soc-ph":"Physics and Society","physics.space-ph":"Space Physics","q-bio.BM":"Biomolecules","q-bio.CB":"Cell Behavior","q-bio.GN":"Genomics","q-bio.MN":"Molecular Networks","q-bio.NC":"Neurons and Cognition","q-bio.OT":"Other Quantitative Biology","q-bio.PE":"Populations and Evolution","q-bio.QM":"Quantitative Methods","q-bio.SC":"Subcellular Processes","q-bio.TO":"Tissues and Organs","q-fin.CP":"Computational Finance","q-fin.EC":"Economics","q-fin.GN":"General Finance","q-fin.MF":"Mathematical Finance","q-fin.PM":"Portfolio Management","q-fin.PR":"Pricing of Securities","q-fin.RM":"Risk Management","q-fin.ST":"Statistical Finance","q-fin.TR":"Trading and Market Microstructure","quant-ph":"Quantum Physics","stat.AP":"Applications","stat.CO":"Computation","stat.ME":"Methodology","stat.ML":"Machine Learning","stat.OT":"Other Statistics","stat.TH":"Statistics Theory"};var prefs={data:{},load(name="prefs"){let cookieDecoded=decodeURIComponent(document.cookie).split(";");let cname=name+"=";for(let i=0;i<cookieDecoded.length;i++){let cook=cookieDecoded[parseInt(i,10)];while(cook[0]===" "){cook=cook.slice(1);}
if(cook.indexOf(cname)===0){this.data=JSON.parse(cook.substring(cname.length,cook.length));}}
return this.data;},save(expires,path){var d=expires||new Date(2100,2,2);var p=path||"/";document.cookie="prefs="+encodeURIComponent(JSON.stringify(this.data))
+";expires="+d.toUTCString()
+";path="+p;}};prefs.load();if(!prefs.data.hasOwnProperty("catsArr")){prefs.data.catsArr=[];}
if(!prefs.data.hasOwnProperty("catsShowArr")){prefs.data.catsShowArr=[];}
if(!prefs.data.hasOwnProperty("showNov")){prefs.data.showNov=[true,true,true];}
prefs.save();var catNew=[];function addCat(cat){let parent=document.createElement("div");parent.setAttribute("class","d-flex");parent.setAttribute("id","par-cat-"+cat.replaceAll(".","111"))
let close=document.createElement("button");close.setAttribute("id","close_"+cat.replaceAll(".","111"));close.setAttribute("class","close close-btn");close.innerHTML="&times"
close.onclick=function(event){let name=event.target.getAttribute("id").split("_")[1]
$("#par-cat-"+name).removeClass("d-flex");$("#par-cat-"+name).fadeOut();$(".btn").removeClass("disabled");const catId=catNew.indexOf(name.replace("111","."));if(catId>-1){catNew.splice(catId,1);}}
let catElement=document.createElement("div");catElement.setAttribute("class","pl-2");catElement.textContent=allCatsArray[cat];document.getElementById("cats-list").appendChild(parent);parent.appendChild(close);parent.appendChild(catElement);}
function renderCats(){$("#cats-list").empty();catNew=[];CATS.forEach((cat,num)=>{addCat(cat);catNew.push(cat);});}
function renderTags(){$("#tag-list").empty();TAGS.forEach((tag,num)=>{let tagElement=document.createElement("div");tagElement.setAttribute("class","tag-label");tagElement.setAttribute("id","tag-label-"+num);tagElement.setAttribute("style","background-color: "+tag.color);tagElement.textContent=tag.name;document.getElementById("tag-list").appendChild(tagElement);});if(parseTex){MathJax.typesetPromise();}
let tagElement=document.createElement("div");tagElement.setAttribute("class","add-set tag-label");tagElement.setAttribute("id","add-tag");tagElement.textContent="New";document.getElementById("tag-list").appendChild(tagElement);}
function renderPref(){return;}
function reloadSettings(){if(CATS!==catNew){renderCats();}
renderTags();document.forms["add-tag"]["tag_name"].value="";document.forms["add-tag"]["tag_rule"].value="";document.forms["add-tag"]["tag_color"].value="";document.forms["add-tag"]["tag_order"].value="";renderPref();}
window.onload=function(event){$.each(allCatsArray,function(val,text){$("#catsDataList").append($("<option>").attr("value",val).text(text));});reloadSettings()}
function fillCatForm(){if($(".btn-cancel").hasClass("disabled")){return false;}
let hiddenText=document.createElement("input");hiddenText.setAttribute("type","text");hiddenText.setAttribute("name","catNew");hiddenText.setAttribute("style","display: none;");hiddenText.value=catNew.toString();document.forms["mod-cat"].appendChild(hiddenText);return true;}
$("#add-cat-btn").click((event)=>{cat=document.forms["add-cat"]["cat_name"].value;if(catNew.includes(cat)){alert("Catagory already added!");return;}
if(allCatsArray[cat]===undefined){alert("Unknown category");return;}
$(".btn-save").removeClass("disabled");addCat(document.forms["add-cat"]["cat_name"].value);document.forms["add-cat"]["cat_name"].value="";catNew.push(cat);});$(".btn-cancel").click((event)=>{if(!$(".btn-cancel").hasClass("disabled")){location.reload();}});$("#show-rules").click((event)=>{if($("#tag-help").css("display")==="block"){$("#tag-help").css("display","none");}else{$("#tag-help").css("display","block");}});var newTag=true;var editTagId=-1;$("#tag-list").click((event)=>{if(!$(event.target).attr("class").includes("tag-label")){return;}
$("#btn-del").removeClass("disabled");if(!$(".btn-cancel").hasClass("disabled")){if(confirm("Settings will not be saved. Continue?")){$(".btn-save").addClass("disabled");event.preventDefault();}else{event.preventDefault();return;}}
let tagCol=document.getElementsByClassName("tag-label");for(let id=0;id<tagCol.length;id++){$("#tag-label-"+parseInt(id,10)).css("border-color","transparent");if($(tagCol[parseInt(id,10)]).attr("id")==="add-tag"){$("#add-tag").css("border-style","dashed");$("#add-tag").css("border-width","2px");}}
if($(event.target).attr("id")==="add-tag"){newTag=true;$("#btn-reset").click();$("#add-tag").css("border-style","solid");$("#add-tag").css("border-width","4px");document.forms["add-tag"]["tag_name"].value="";document.forms["add-tag"]["tag_rule"].value="";document.forms["add-tag"]["tag_color"].value="";document.forms["add-tag"]["tag_order"].value="";}else{newTag=false;editTagId=$(event.target).attr("id").split("-")[2];let tag=TAGS[parseInt(editTagId,10)];$(event.target).css("border-color","#000");$("#tag-fields").prop("disabled",false);document.forms["add-tag"]["tag_name"].value=tag.name;document.forms["add-tag"]["tag_rule"].value=tag.rule;document.forms["add-tag"]["tag_color"].value=tag.color;document.forms["add-tag"]["tag_order"].value=editTagId;$("#tag-color").css("background-color",$("#tag-color").val());}
$("#tag-fields").prop("disabled",false);});$(".tag-field").on("input",function(event){$(".btn-save").removeClass("disabled");});$("#tag-color").on("change",function(event){$("#tag-color").css("background-color",$("#tag-color").val());$(".btn-save").removeClass("disabled");});function fillTagForm(){if($(".btn-cancel").hasClass("disabled")){return false;}
return checkTag();}
function submitTag(){let url="mod_tag";$.post(url,JSON.stringify(TAGS)).done(function(data){reloadSettings();$(".btn-save").addClass("disabled");$("#btn-del").addClass("disabled");}).fail(function(jqXHR){alert(jqXHR);});}
function checkTag(){$(".cat-alert").html("");if(document.forms["add-tag"]["tag_name"].value===""||document.forms["add-tag"]["tag_rule"].value===""||document.forms["add-tag"]["tag_color"].value===""||document.forms["add-tag"]["tag_order"].value===""){$(".cat-alert").html("Fill all the fields in the form!");return false;}
let rule=document.forms["add-tag"]["tag_rule"].value;if(!/^(ti|au|abs){.*?}((\||\&)(\(|)((ti|au|abs){.*?})(\)|))*$/i.test(rule)){$(".cat-alert").html("Check the rule syntax!");return false;}
if(!/^#[0-9A-F]{6}$/i.test(document.forms["add-tag"]["tag_color"].value)){$(".cat-alert").html("Color should be in hex format: e.g. #aaaaaa");return false;}
if(!/^[0-9]/i.test(document.forms["add-tag"]["tag_order"].value)){$(".cat-alert").html("Order should be an integer");return false;}
let TagDict={"name":document.forms["add-tag"]["tag_name"].value,"rule":document.forms["add-tag"]["tag_rule"].value,"color":document.forms["add-tag"]["tag_color"].value};let order=parseInt(document.forms["add-tag"]["tag_order"].value,10);if(!newTag){TAGS.splice(editTagId,1);}
TAGS.splice(order,0,TagDict);submitTag();}
$("#btn-del").click((event)=>{if(confirm("Are you sure you want to delete "+TAGS[editTagId].name+"?")){TAGS.splice(editTagId,1);submitTag();event.preventDefault();}else{event.preventDefault();return;}});$(".nav-link").click((event)=>{if(!$(".btn-cancel").hasClass("disabled")){if(confirm("Settings will not be saved. Continue?")){$(".btn-save").addClass("disabled");reloadSettings();event.preventDefault();}else{event.preventDefault();return;}}
$("#cats-set").css("display","none");$("#tags-set").css("display","none");$("#pref-set").css("display","none");$("#cats-link").removeClass("active");$("#tags-link").removeClass("active");$("#pref-link").removeClass("active");$("#"+event.target.getAttribute("id").split("-")[0]
+"-set").css("display","block");$(event.target).addClass("active");});(function($){$.fn.wheelColorPicker=function(){var returnValue=this;if(arguments.length>0){var shift=[].shift;var firstArg=shift.apply(arguments);var firstArgUc=(typeof firstArg==="string")?firstArg.charAt(0).toUpperCase()+firstArg.slice(1):firstArg;}
else{var firstArg=undefined;var firstArgUc=undefined;}
var args=arguments;this.each(function(){var instance=$(this).data('jQWCP.instance');if(instance==undefined||instance==null){var options={};if(typeof firstArg==="object"){options=firstArg;}
instance=new WCP.ColorPicker(this,options);$(this).data('jQWCP.instance',instance);}
if(firstArg===undefined||typeof firstArg==="object"){}
else if(typeof instance[firstArg]==="function"){var ret=instance[firstArg].apply(instance,args);if(ret!==instance){returnValue=ret;return false;}}
else if(typeof instance['set'+firstArgUc]==="function"&&args.length>0){var ret=instance['set'+firstArgUc].apply(instance,args);if(ret!==instance){returnValue=ret;return false;}}
else if(typeof instance['get'+firstArgUc]==="function"){var ret=instance['get'+firstArgUc].apply(instance,args);if(ret!==instance){returnValue=ret;return false;}}
else if(instance.options[firstArg]!==undefined&&args.length>0){instance.options[firstArg]=args[0];}
else if(instance.options[firstArg]!==undefined){returnValue=instance.options[firstArg];return false;}
else{$.error('Method/option named '+firstArg+' does not exist on jQuery.wheelColorPicker');}});return returnValue;};var WCP=$.fn.wheelColorPicker;WCP.defaults={format:'hex',preview:false,live:true,userinput:true,validate:true,autoResize:true,autoFormat:true,preserveWheel:null,cssClass:'',layout:'popup',animDuration:200,quality:1,sliders:null,rounding:2,mobile:true,mobileWidth:480,hideKeyboard:false,htmlOptions:true,snap:false,snapTolerance:0.05 };WCP.BUG_RELATIVE_PAGE_ORIGIN=false;WCP.ORIGIN={left:0,top:0};WCP.colorToStr=function(color,format){var result="";switch(format){case'css':result="#";case'hex':var r=Math.round(color.r*255).toString(16);if(r.length==1){r="0"+r;}
var g=Math.round(color.g*255).toString(16);if(g.length==1){g="0"+g;}
var b=Math.round(color.b*255).toString(16);if(b.length==1){b="0"+b;}
result+=r+g+b;break;case'cssa':result="#";case'hexa':var r=Math.round(color.r*255).toString(16);if(r.length==1){r="0"+r;}
var g=Math.round(color.g*255).toString(16);if(g.length==1){g="0"+g;}
var b=Math.round(color.b*255).toString(16);if(b.length==1){b="0"+b;}
var a=Math.round(color.a*255).toString(16);if(a.length==1){a="0"+a;}
result+=r+g+b+a;break;case'rgb':result="rgb("+
Math.round(color.r*255)+","+
Math.round(color.g*255)+","+
Math.round(color.b*255)+")";break;case'rgb%':result="rgb("+
(color.r*100)+"%,"+
(color.g*100)+"%,"+
(color.b*100)+"%)";break;case'rgba':result="rgba("+
Math.round(color.r*255)+","+
Math.round(color.g*255)+","+
Math.round(color.b*255)+","+
color.a+")";break;case'rgba%':result="rgba("+
(color.r*100)+"%,"+
(color.g*100)+"%,"+
(color.b*100)+"%,"+
(color.a*100)+"%)";break;case'hsv':result="hsv("+
(color.h*360)+","+
color.s+","+
color.v+")";break;case'hsv%':result="hsv("+
(color.h*100)+"%,"+
(color.s*100)+"%,"+
(color.v*100)+"%)";break;case'hsva':result="hsva("+
(color.h*360)+","+
color.s+","+
color.v+","+
color.a+")";break;case'hsva%':result="hsva("+
(color.h*100)+"%,"+
(color.s*100)+"%,"+
(color.v*100)+"%,"+
(color.a*100)+"%)";break;case'hsb':result="hsb("+
color.h+","+
color.s+","+
color.v+")";break;case'hsb%':result="hsb("+
(color.h*100)+"%,"+
(color.s*100)+"%,"+
(color.v*100)+"%)";break;case'hsba':result="hsba("+
color.h+","+
color.s+","+
color.v+","+
color.a+")";break;case'hsba%':result="hsba("+
(color.h*100)+"%,"+
(color.s*100)+"%,"+
(color.v*100)+"%,"+
(color.a*100)+"%)";break;}
return result;};WCP.strToColor=function(val){var color={a:1};var tmp;var hasAlpha;if(val.match(/^#[0-9a-f]{3}$/i)!=null||val.match(/^#[0-9a-f]{4}$/i)){if(isNaN(color.r=parseInt(val.substr(1,1),16)*17/255)){return false;}
if(isNaN(color.g=parseInt(val.substr(2,1),16)*17/255)){return false;}
if(isNaN(color.b=parseInt(val.substr(3,1),16)*17/255)){return false;}
if(val.length==5){if(isNaN(color.a=parseInt(val.substr(4,1),16)*17/255)){return false;}}}
else if(val.match(/^[0-9a-f]{3}$/i)!=null||val.match(/^[0-9a-f]{4}$/i)!=null){if(isNaN(color.r=parseInt(val.substr(0,1),16)*17/255)){return false;}
if(isNaN(color.g=parseInt(val.substr(1,1),16)*17/255)){return false;}
if(isNaN(color.b=parseInt(val.substr(2,1),16)*17/255)){return false;}
if(val.length==4){if(isNaN(color.a=parseInt(val.substr(3,1),16)*17/255)){return false;}}}
else if(val.match(/^#[0-9a-f]{6}$/i)!=null||val.match(/^#[0-9a-f]{8}$/i)!=null){if(isNaN(color.r=parseInt(val.substr(1,2),16)/255)){return false;}
if(isNaN(color.g=parseInt(val.substr(3,2),16)/255)){return false;}
if(isNaN(color.b=parseInt(val.substr(5,2),16)/255)){return false;}
if(val.length==9){if(isNaN(color.a=parseInt(val.substr(7,2),16)/255)){return false;}}}
else if(val.match(/^[0-9a-f]{6}$/i)!=null||val.match(/^[0-9a-f]{8}$/i)!=null){if(isNaN(color.r=parseInt(val.substr(0,2),16)/255)){return false;}
if(isNaN(color.g=parseInt(val.substr(2,2),16)/255)){return false;}
if(isNaN(color.b=parseInt(val.substr(4,2),16)/255)){return false;}
if(val.length==8){if(isNaN(color.a=parseInt(val.substr(6,2),16)/255)){return false;}}}
else if(val.match(/^rgba\s*\(\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*\)$/i)!=null||val.match(/^rgb\s*\(\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*\)$/i)!=null){if(val.match(/a/i)!=null){hasAlpha=true;}
else{hasAlpha=false;}
tmp=val.substring(val.indexOf('(')+1,val.indexOf(','));if(tmp.charAt(tmp.length-1)=='%'){if(isNaN(color.r=parseFloat(tmp)/100)){return false;}}
else{if(isNaN(color.r=parseInt(tmp)/255)){return false;}}
tmp=val.substring(val.indexOf(',')+1,val.indexOf(',',val.indexOf(',')+1));if(tmp.charAt(tmp.length-1)=='%'){if(isNaN(color.g=parseFloat(tmp)/100)){return false;}}
else{if(isNaN(color.g=parseInt(tmp)/255)){return false;}}
if(hasAlpha){tmp=val.substring(val.indexOf(',',val.indexOf(',')+1)+1,val.lastIndexOf(','));}
else{tmp=val.substring(val.lastIndexOf(',')+1,val.lastIndexOf(')'));}
if(tmp.charAt(tmp.length-1)=='%'){if(isNaN(color.b=parseFloat(tmp)/100)){return false;}}
else{if(isNaN(color.b=parseInt(tmp)/255)){return false;}}
if(hasAlpha){tmp=val.substring(val.lastIndexOf(',')+1,val.lastIndexOf(')'));if(tmp.charAt(tmp.length-1)=='%'){if(isNaN(color.a=parseFloat(tmp)/100)){return false;}}
else{if(isNaN(color.a=parseFloat(tmp))){return false;}}}}
else if(val.match(/^hsva\s*\(\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*\)$/i)!=null||val.match(/^hsv\s*\(\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*\)$/i)!=null||val.match(/^hsba\s*\(\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*\)$/i)!=null||val.match(/^hsb\s*\(\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*,\s*([0-9\.]+%|[01]?\.?[0-9]*)\s*\)$/i)!=null){if(val.match(/a/i)!=null){hasAlpha=true;}
else{hasAlpha=false;}
tmp=val.substring(val.indexOf('(')+1,val.indexOf(','));if(tmp.charAt(tmp.length-1)=='%'){if(isNaN(color.h=parseFloat(tmp)/100)){return false;}}
else{if(isNaN(color.h=parseFloat(tmp)/360)){return false;}}
tmp=val.substring(val.indexOf(',')+1,val.indexOf(',',val.indexOf(',')+1));if(tmp.charAt(tmp.length-1)=='%'){if(isNaN(color.s=parseFloat(tmp)/100)){return false;}}
else{if(isNaN(color.s=parseFloat(tmp))){return false;}}
if(hasAlpha){tmp=val.substring(val.indexOf(',',val.indexOf(',')+1)+1,val.lastIndexOf(','));}
else{tmp=val.substring(val.lastIndexOf(',')+1,val.lastIndexOf(')'));}
if(tmp.charAt(tmp.length-1)=='%'){if(isNaN(color.v=parseFloat(tmp)/100)){return false;}}
else{if(isNaN(color.v=parseFloat(tmp))){return false;}}
if(hasAlpha){tmp=val.substring(val.lastIndexOf(',')+1,val.lastIndexOf(')'));if(tmp.charAt(tmp.length-1)=='%'){if(isNaN(color.a=parseFloat(tmp)/100)){return false;}}
else{if(isNaN(color.a=parseFloat(tmp))){return false;}}}}
else{return false;}
return color;};WCP.hsvToRgb=function(h,s,v){var cr=(h<=(1/6)||h>=(5/6))?1:(h<(1/3)?1-((h-(1/6))*6):(h>(4/6)?(h-(4/6))*6:0));var cg=(h>=(1/6)&&h<=(3/6))?1:(h<(1/6)?h*6:(h<(4/6)?1-((h-(3/6))*6):0));var cb=(h>=(3/6)&&h<=(5/6))?1:(h>(2/6)&&h<(3/6)?(h-(2/6))*6:(h>(5/6)?1-((h-(5/6))*6):0));var r=(cr+(1-cr)*(1-s))*v;var g=(cg+(1-cg)*(1-s))*v;var b=(cb+(1-cb)*(1-s))*v;return{r:r,g:g,b:b};};WCP.rgbToHsv=function(r,g,b){var h;var s;var v;var maxColor=Math.max(r,g,b);var minColor=Math.min(r,g,b);var delta=maxColor-minColor;if(maxColor!=0){s=delta/maxColor;}
else{s=0;}
if(delta==0){h=0;}
else if(r==maxColor){h=(6+(g-b)/delta)%6;}
else if(g==maxColor){h=2+(b-r)/delta;}
else if(b==maxColor){h=4+(r-g)/delta;}
else{h=0;}
h=h/6;v=maxColor;return{h:h,s:s,v:v};};WCP.ColorPicker=function(elm,options){this.input=elm;this.color={h:0,s:0,v:1,r:1,g:1,b:1,a:1};this.setValue(this.input.value);this.options=$.extend(true,{},WCP.defaults);this.setOptions(options);if(this.options.sliders==null)
this.options.sliders='wvp'+(this.options.format.indexOf('a')>=0?'a':'');this.init();};WCP.ColorPicker.widget=null;WCP.ColorPicker.overlay=null;WCP.ColorPicker.init=function(){if(WCP.ColorPicker.init.hasInit==true)
return;WCP.ColorPicker.init.hasInit=true;var $overlay=$('<div class="jQWCP-overlay" style="display: none;"></div>');$overlay.on('click',WCP.Handler.overlay_click);WCP.ColorPicker.overlay=$overlay.get(0);$('body').append($overlay);var wheelImage=WCP.ColorPicker.getWheelDataUrl(200);$('head').append('<style type="text/css">'+
'.jQWCP-wWheel {'+
'background-image: url('+wheelImage+');'+
'}'+
'</style>');$('html').on('mouseup.wheelColorPicker',WCP.Handler.html_mouseup);$('html').on('touchend.wheelColorPicker',WCP.Handler.html_mouseup);$('html').on('mousemove.wheelColorPicker',WCP.Handler.html_mousemove);$('html').on('touchmove.wheelColorPicker',WCP.Handler.html_mousemove);$(window).on('resize.wheelColorPicker',WCP.Handler.window_resize);};WCP.ColorPicker.createWidget=function(){var $widget=$("<div class='jQWCP-wWidget'>"+
"<div class='jQWCP-wWheel'>"+
"<div class='jQWCP-wWheelOverlay'></div>"+
"<span class='jQWCP-wWheelCursor'></span>"+
"</div>"+
"<div class='jQWCP-wHue jQWCP-slider-wrapper'>"+
"<canvas class='jQWCP-wHueSlider jQWCP-slider' width='1' height='50' title='Hue'></canvas>"+
"<span class='jQWCP-wHueCursor jQWCP-scursor'></span>"+
"</div>"+
"<div class='jQWCP-wSat jQWCP-slider-wrapper'>"+
"<canvas class='jQWCP-wSatSlider jQWCP-slider' width='1' height='50' title='Saturation'></canvas>"+
"<span class='jQWCP-wSatCursor jQWCP-scursor'></span>"+
"</div>"+
"<div class='jQWCP-wVal jQWCP-slider-wrapper'>"+
"<canvas class='jQWCP-wValSlider jQWCP-slider' width='1' height='50' title='Value'></canvas>"+
"<span class='jQWCP-wValCursor jQWCP-scursor'></span>"+
"</div>"+
"<div class='jQWCP-wRed jQWCP-slider-wrapper'>"+
"<canvas class='jQWCP-wRedSlider jQWCP-slider' width='1' height='50' title='Red'></canvas>"+
"<span class='jQWCP-wRedCursor jQWCP-scursor'></span>"+
"</div>"+
"<div class='jQWCP-wGreen jQWCP-slider-wrapper'>"+
"<canvas class='jQWCP-wGreenSlider jQWCP-slider' width='1' height='50' title='Green'></canvas>"+
"<span class='jQWCP-wGreenCursor jQWCP-scursor'></span>"+
"</div>"+
"<div class='jQWCP-wBlue jQWCP-slider-wrapper'>"+
"<canvas class='jQWCP-wBlueSlider jQWCP-slider' width='1' height='50' title='Blue'></canvas>"+
"<span class='jQWCP-wBlueCursor jQWCP-scursor'></span>"+
"</div>"+
"<div class='jQWCP-wAlpha jQWCP-slider-wrapper'>"+
"<canvas class='jQWCP-wAlphaSlider jQWCP-slider' width='1' height='50' title='Alpha'></canvas>"+
"<span class='jQWCP-wAlphaCursor jQWCP-scursor'></span>"+
"</div>"+
"<div class='jQWCP-wPreview'>"+
"<canvas class='jQWCP-wPreviewBox' width='1' height='1' title='Selected Color'></canvas>"+
"</div>"+
"</div>");$widget.find('.jQWCP-wWheel, .jQWCP-slider-wrapper, .jQWCP-scursor, .jQWCP-slider').attr('unselectable','on').css('-moz-user-select','none').css('-webkit-user-select','none').css('user-select','none').css('-webkit-touch-callout','none');$widget.on('contextmenu.wheelColorPicker',function(){return false;});$widget.on('mousedown.wheelColorPicker','.jQWCP-wWheel',WCP.Handler.wheel_mousedown);$widget.on('touchstart.wheelColorPicker','.jQWCP-wWheel',WCP.Handler.wheel_mousedown);$widget.on('mousedown.wheelColorPicker','.jQWCP-wWheelCursor',WCP.Handler.wheelCursor_mousedown);$widget.on('touchstart.wheelColorPicker','.jQWCP-wWheelCursor',WCP.Handler.wheelCursor_mousedown);$widget.on('mousedown.wheelColorPicker','.jQWCP-slider',WCP.Handler.slider_mousedown);$widget.on('touchstart.wheelColorPicker','.jQWCP-slider',WCP.Handler.slider_mousedown);$widget.on('mousedown.wheelColorPicker','.jQWCP-scursor',WCP.Handler.sliderCursor_mousedown);$widget.on('touchstart.wheelColorPicker','.jQWCP-scursor',WCP.Handler.sliderCursor_mousedown);return $widget.get(0);};WCP.ColorPicker.getWheelDataUrl=function(size){var r=size/2;var center=r;var canvas=document.createElement('canvas');canvas.width=size;canvas.height=size;var context=canvas.getContext('2d');for(var y=0;y<size;y++){for(var x=0;x<size;x++){var offset=Math.sqrt(Math.pow(x-center,2)+Math.pow(y-center,2));if(offset>r+2){continue;}
var deg=((x-center==0?(y<center?90:270):(Math.atan((center-y)/(x-center))/Math.PI*180))
+(x<center?180:0)
+360)%360;var sat=offset/r;var val=1;var cr=(Math.abs(deg+360)+60)%360<120?1:(deg>240?(120-Math.abs(deg-360))/60:(deg<120?(120-deg)/60:0));var cg=Math.abs(deg-120)<60?1:(Math.abs(deg-120)<120?(120-Math.abs(deg-120))/60:0);var cb=Math.abs(deg-240)<60?1:(Math.abs(deg-240)<120?(120-Math.abs(deg-240))/60:0);var pr=Math.round((cr+(1-cr)*(1-sat))*255);var pg=Math.round((cg+(1-cg)*(1-sat))*255);var pb=Math.round((cb+(1-cb)*(1-sat))*255);context.fillStyle='rgb('+pr+','+pg+','+pb+')';context.fillRect(x,y,1,1);}}
return canvas.toDataURL();};WCP.ColorPicker.prototype.options=null;WCP.ColorPicker.prototype.input=null;WCP.ColorPicker.prototype.widget=null;WCP.ColorPicker.prototype.color=null;WCP.ColorPicker.prototype.lastValue=null;WCP.ColorPicker.prototype.setOptions=function(options){options=$.extend(true,{},options);if(this.options.htmlOptions){for(var key in WCP.defaults){if(this.input.hasAttribute('data-wcp-'+key)&&options[key]===undefined){options[key]=this.input.getAttribute('data-wcp-'+key);if(options[key]=='true'){options[key]=true;}
else if(options[key]=='false'){options[key]=false;}}}}
for(var key in options){if(this.options[key]===undefined)
continue;var keyUc=key.charAt(0).toUpperCase()+key.slice(1);if(typeof this['set'+keyUc]==="function"){this['set'+keyUc](options[key]);}
else{this.options[key]=options[key];}}
return this;};WCP.ColorPicker.prototype.init=function(){WCP.ColorPicker.init();if(this.hasInit==true)
return;this.hasInit=true;var instance=this;var $input=$(this.input);var $widget=null;if(this.options.layout=='block'){this.widget=WCP.ColorPicker.createWidget();$widget=$(this.widget);$widget.data('jQWCP.instance',this);$widget.insertAfter(this.input);if($input.css('display')=="inline"){$widget.css('display',"inline-block");}
else{$widget.css('display',$input.css('display'));}
$widget.append(this.input);$input.hide();if($input.attr('tabindex')!=undefined){$widget.attr('tabindex',$input.attr('tabindex'));}
else{$widget.attr('tabindex',0);}
this.refreshWidget();this.redrawSliders(true);this.updateSliders();$widget.on('focus.wheelColorPicker',WCP.Handler.widget_focus_block);$widget.on('blur.wheelColorPicker',WCP.Handler.widget_blur_block);}
else{if(WCP.ColorPicker.widget==null){WCP.ColorPicker.widget=WCP.ColorPicker.createWidget();$widget=$(WCP.ColorPicker.widget);$widget.attr('id','jQWCP-popup');$widget.hide();$('body').append($widget);$widget.on('mousedown.wheelColorPicker',WCP.Handler.widget_mousedown_popup);}
this.widget=WCP.ColorPicker.widget;$input.on('focus.wheelColorPicker',WCP.Handler.input_focus_popup);$input.on('blur.wheelColorPicker',WCP.Handler.input_blur_popup);}
$input.on('keyup.wheelColorPicker',WCP.Handler.input_keyup);$input.on('change.wheelColorPicker',WCP.Handler.input_change);if(typeof this.options.color=="object"){this.setColor(this.options.color);this.options.color=undefined;}
else if(typeof this.options.color=="string"){this.setValue(this.options.color);this.options.color=undefined;}
if(this.options.userinput){$input.removeAttr('readonly');}
else{$input.attr('readonly',true);}};WCP.ColorPicker.prototype.destroy=function(){var $widget=$(this.widget);var $input=$(this.input);if(this.options.layout=='block'){var $control=$($('body').data('jQWCP.activeControl'));if($control.length){var controlWidget=$control.closest('.jQWCP-wWidget');if($widget.is(controlWidget)){$('body').data('jQWCP.activeControl',null);}}
$widget.before(this.input);$widget.remove();$input.show();}
$input.off('focus.wheelColorPicker');$input.off('blur.wheelColorPicker');$input.off('keyup.wheelColorPicker');$input.off('change.wheelColorPicker');$input.data('jQWCP.instance',null);delete this;};WCP.ColorPicker.prototype.refreshWidget=function(){var $widget=$(this.widget);var options=this.options;var mobileLayout=false;$widget.attr('class','jQWCP-wWidget');if(options.layout=='block'){$widget.addClass('jQWCP-block');}
$widget.addClass(options.cssClass);if(window.innerWidth<=options.mobileWidth&&options.layout!='block'&&options.mobile){mobileLayout=true;$widget.addClass('jQWCP-mobile');}
$widget.find('.jQWCP-wWheel, .jQWCP-slider-wrapper, .jQWCP-wPreview').hide().addClass('hidden');for(var i in options.sliders){var $slider=null;switch(this.options.sliders[i]){case'w':$slider=$widget.find('.jQWCP-wWheel');break;case'h':$slider=$widget.find('.jQWCP-wHue');break;case's':$slider=$widget.find('.jQWCP-wSat');break;case'v':$slider=$widget.find('.jQWCP-wVal');break;case'r':$slider=$widget.find('.jQWCP-wRed');break;case'g':$slider=$widget.find('.jQWCP-wGreen');break;case'b':$slider=$widget.find('.jQWCP-wBlue');break;case'a':$slider=$widget.find('.jQWCP-wAlpha');break;case'p':$slider=$widget.find('.jQWCP-wPreview');break;}
if($slider!=null){$slider.appendTo(this.widget);$slider.show().removeClass('hidden');}}
var sliderHeight=options.quality*50;$widget.find('.jQWCP-slider').attr('height',sliderHeight);var $visElms=$widget.find('.jQWCP-wWheel, .jQWCP-slider-wrapper, .jQWCP-wPreview').not('.hidden');if(options.autoResize&&!mobileLayout){var width=0
$visElms.css({width:'',height:''});$visElms.each(function(index,item){var $item=$(item);width+=parseFloat($item.css('margin-left').replace('px',''))+parseFloat($item.css('margin-right').replace('px',''))+$item.outerWidth();});$widget.css({width:width+'px'});}
else{$widget.css({width:''});var $visWheel=$widget.find('.jQWCP-wWheel').not('.hidden');var $visSliders=$widget.find('.jQWCP-slider-wrapper, .jQWCP-wPreview').not('.hidden');$visWheel.css({height:$widget.height()+'px',width:$widget.height()});if($visWheel.length>0){var horzSpace=$widget.width()-$visWheel.outerWidth()-parseFloat($visWheel.css('margin-left').replace('px',''))-parseFloat($visWheel.css('margin-right').replace('px',''));}
else{var horzSpace=$widget.width();}
if($visSliders.length>0){var sliderMargins=parseFloat($visSliders.css('margin-left').replace('px',''))+parseFloat($visSliders.css('margin-right').replace('px',''));$visSliders.css({height:$widget.height()+'px',width:(horzSpace-($visSliders.length-1)*sliderMargins)/$visSliders.length+'px'});}}
return this;};WCP.ColorPicker.prototype.redrawSliders=function(force){if(this.widget==null)
return this;var $widget=$(this.widget);if(typeof arguments[0]==="string"){force=arguments[1];}
if(this!=$widget.data('jQWCP.instance'))
return this;var options=this.options;var color=this.color;var w=1;var h=options.quality*50;var A=1;var R=0;var G=0;var B=0;var H=0;var S=0;var V=1;if(options.live){A=color.a;R=Math.round(color.r*255);G=Math.round(color.g*255);B=Math.round(color.b*255);H=color.h;S=color.s;V=color.v;}
var $previewBox=$widget.find('.jQWCP-wPreviewBox');if(!$previewBox.hasClass('hidden')){var previewBoxCtx=$previewBox.get(0).getContext('2d');previewBoxCtx.fillStyle="rgba("+R+","+G+","+B+","+A+")";previewBoxCtx.clearRect(0,0,1,1);previewBoxCtx.fillRect(0,0,1,1);}
if(!this.options.live&&!force)
return this;var $alphaSlider=$widget.find('.jQWCP-wAlphaSlider');if(!$alphaSlider.hasClass('hidden')||force){var alphaSliderCtx=$alphaSlider.get(0).getContext('2d');var alphaGradient=alphaSliderCtx.createLinearGradient(0,0,0,h);alphaGradient.addColorStop(0,"rgba("+R+","+G+","+B+",1)");alphaGradient.addColorStop(1,"rgba("+R+","+G+","+B+",0)");alphaSliderCtx.fillStyle=alphaGradient;alphaSliderCtx.clearRect(0,0,w,h);alphaSliderCtx.fillRect(0,0,w,h);}
var $redSlider=$widget.find('.jQWCP-wRedSlider');if(!$redSlider.hasClass('hidden')||force){var redSliderCtx=$redSlider.get(0).getContext('2d');var redGradient=redSliderCtx.createLinearGradient(0,0,0,h);redGradient.addColorStop(0,"rgb(255,"+G+","+B+")");redGradient.addColorStop(1,"rgb(0,"+G+","+B+")");redSliderCtx.fillStyle=redGradient;redSliderCtx.fillRect(0,0,w,h);}
var $greenSlider=$widget.find('.jQWCP-wGreenSlider');if(!$greenSlider.hasClass('hidden')||force){var greenSliderCtx=$greenSlider.get(0).getContext('2d');var greenGradient=greenSliderCtx.createLinearGradient(0,0,0,h);greenGradient.addColorStop(0,"rgb("+R+",255,"+B+")");greenGradient.addColorStop(1,"rgb("+R+",0,"+B+")");greenSliderCtx.fillStyle=greenGradient;greenSliderCtx.fillRect(0,0,w,h);}
var $blueSlider=$widget.find('.jQWCP-wBlueSlider');if(!$blueSlider.hasClass('hidden')||force){var blueSliderCtx=$blueSlider.get(0).getContext('2d');var blueGradient=blueSliderCtx.createLinearGradient(0,0,0,h);blueGradient.addColorStop(0,"rgb("+R+","+G+",255)");blueGradient.addColorStop(1,"rgb("+R+","+G+",0)");blueSliderCtx.fillStyle=blueGradient;blueSliderCtx.fillRect(0,0,w,h);}
var $hueSlider=$widget.find('.jQWCP-wHueSlider');if(!$hueSlider.hasClass('hidden')||force){var hueSliderCtx=$hueSlider.get(0).getContext('2d');var hueGradient=hueSliderCtx.createLinearGradient(0,0,0,h);hueGradient.addColorStop(0,"#f00");hueGradient.addColorStop(0.166666667,"#ff0");hueGradient.addColorStop(0.333333333,"#0f0");hueGradient.addColorStop(0.5,"#0ff");hueGradient.addColorStop(0.666666667,"#00f");hueGradient.addColorStop(0.833333333,"#f0f");hueGradient.addColorStop(1,"#f00");hueSliderCtx.fillStyle=hueGradient;hueSliderCtx.fillRect(0,0,w,h);}
var $satSlider=$widget.find('.jQWCP-wSatSlider');if(!$satSlider.hasClass('hidden')||force){var satTopRgb=$.fn.wheelColorPicker.hsvToRgb(H,1,V);satTopRgb.r=Math.round(satTopRgb.r*255);satTopRgb.g=Math.round(satTopRgb.g*255);satTopRgb.b=Math.round(satTopRgb.b*255);var satSliderCtx=$satSlider.get(0).getContext('2d');var satGradient=satSliderCtx.createLinearGradient(0,0,0,h);satGradient.addColorStop(0,"rgb("+satTopRgb.r+","+satTopRgb.g+","+satTopRgb.b+")");satGradient.addColorStop(1,"rgb("+Math.round(V*255)+","+Math.round(V*255)+","+Math.round(V*255)+")");satSliderCtx.fillStyle=satGradient;satSliderCtx.fillRect(0,0,w,h);}
var $valSlider=$widget.find('.jQWCP-wValSlider');if(!$valSlider.hasClass('hidden')||force){var valTopRgb=$.fn.wheelColorPicker.hsvToRgb(H,S,1);valTopRgb.r=Math.round(valTopRgb.r*255);valTopRgb.g=Math.round(valTopRgb.g*255);valTopRgb.b=Math.round(valTopRgb.b*255);var valSliderCtx=$valSlider.get(0).getContext('2d');var valGradient=valSliderCtx.createLinearGradient(0,0,0,h);valGradient.addColorStop(0,"rgb("+valTopRgb.r+","+valTopRgb.g+","+valTopRgb.b+")");valGradient.addColorStop(1,"#000");valSliderCtx.fillStyle=valGradient;valSliderCtx.fillRect(0,0,w,h);}
return this;};WCP.ColorPicker.prototype.updateSliders=function(){if(this.widget==null)
return this;var $widget=$(this.widget);var color=this.color;if(this!=$widget.data('jQWCP.instance'))
return this;var $wheel=$widget.find('.jQWCP-wWheel');if(!$wheel.hasClass('hidden')){var $wheelCursor=$widget.find('.jQWCP-wWheelCursor');var $wheelOverlay=$widget.find('.jQWCP-wWheelOverlay');var wheelX=Math.cos(2*Math.PI*color.h)*color.s;var wheelY=Math.sin(2*Math.PI*color.h)*color.s;var wheelOffsetX=$wheel.width()/2;var wheelOffsetY=$wheel.height()/2;$wheelCursor.css('left',(wheelOffsetX+(wheelX*$wheel.width()/2))+'px');$wheelCursor.css('top',(wheelOffsetY-(wheelY*$wheel.height()/2))+'px');if(this.options.preserveWheel==true||(this.options.preserveWheel==null&&this.options.live==false)){$wheelOverlay.css('opacity',0);}
else{$wheelOverlay.css('opacity',1-(color.v<0.2?0.2:color.v));}}
var $hueSlider=$widget.find('.jQWCP-wHueSlider');if(!$hueSlider.hasClass('hidden')){var $hueCursor=$widget.find('.jQWCP-wHueCursor');$hueCursor.css('top',(color.h*$hueSlider.height())+'px');}
var $satSlider=$widget.find('.jQWCP-wSatSlider');if(!$satSlider.hasClass('hidden')){var $satCursor=$widget.find('.jQWCP-wSatCursor');$satCursor.css('top',((1-color.s)*$satSlider.height())+'px');}
var $valSlider=$widget.find('.jQWCP-wValSlider');if(!$valSlider.hasClass('hidden')){var $valCursor=$widget.find('.jQWCP-wValCursor');$valCursor.css('top',((1-color.v)*$valSlider.height())+'px');}
var $redSlider=$widget.find('.jQWCP-wRedSlider');if(!$redSlider.hasClass('hidden')){var $redCursor=$widget.find('.jQWCP-wRedCursor');$redCursor.css('top',((1-color.r)*$redSlider.height())+'px');}
var $greenSlider=$widget.find('.jQWCP-wGreenSlider');if(!$greenSlider.hasClass('hidden')){var $greenCursor=$widget.find('.jQWCP-wGreenCursor');$greenCursor.css('top',((1-color.g)*$greenSlider.height())+'px');}
var $blueSlider=$widget.find('.jQWCP-wBlueSlider');if(!$blueSlider.hasClass('hidden')){var $blueCursor=$widget.find('.jQWCP-wBlueCursor');$blueCursor.css('top',((1-color.b)*$blueSlider.height())+'px');}
var $alphaSlider=$widget.find('.jQWCP-wAlphaSlider');if(!$alphaSlider.hasClass('hidden')){var $alphaCursor=$widget.find('.jQWCP-wAlphaCursor');$alphaCursor.css('top',((1-color.a)*$alphaSlider.height())+'px');}
return this;};WCP.ColorPicker.prototype.updateSelection=function(){this.redrawSliders();this.updateSliders();return this;};WCP.ColorPicker.prototype.updateInput=function(){if(this.widget==null)
return this;var $input=$(this.input);if(this.input.value!=this.getValue()){$input.attr('value',this.getValue());this.input.value=this.getValue();}
$input.trigger('colorchange');if(this.options.preview){$input.css('background',WCP.colorToStr(this.color,'rgba'));if(this.color.v>.5){$input.css('color','black');}
else{$input.css('color','white');}}};WCP.ColorPicker.prototype.updateActiveControl=function(e){var $control=$($('body').data('jQWCP.activeControl'));if($control.length==0)
return;var $input=$(this.input);var options=this.options;var color=this.color;if(e.originalEvent.touches&&e.originalEvent.touches.length>0){e.pageX=e.originalEvent.touches[0].pageX;e.pageY=e.originalEvent.touches[0].pageY;}
if($control.hasClass('jQWCP-wWheel')){var $cursor=$control.find('.jQWCP-wWheelCursor');var $overlay=$control.find('.jQWCP-wWheelOverlay');var relX=(e.pageX-$control.offset().left-($control.width()/2))/($control.width()/2);var relY=-(e.pageY-$control.offset().top-($control.height()/2))/($control.height()/2);if(WCP.BUG_RELATIVE_PAGE_ORIGIN){var relX=(e.pageX-($control.get(0).getBoundingClientRect().left-WCP.ORIGIN.left)-($control.width()/2))/($control.width()/2);var relY=-(e.pageY-($control.get(0).getBoundingClientRect().top-WCP.ORIGIN.top)-($control.height()/2))/($control.height()/2);}
var sat=Math.sqrt(Math.pow(relX,2)+Math.pow(relY,2));if(sat>1){sat=1;}
if(options.snap&&sat<options.snapTolerance){sat=0;}
var hue=(relX==0&&relY==0)?0:Math.atan(relY/relX)/(2*Math.PI);if(relX<0&&relY==0){hue=0.5;}
if(hue<0){hue+=0.5;}
if(relY<0){hue+=0.5;}
this.setHsv(hue,sat,color.v);}
else if($control.hasClass('jQWCP-slider-wrapper')){var $cursor=$control.find('.jQWCP-scursor');var relY=(e.pageY-$control.offset().top)/$control.height();if(WCP.BUG_RELATIVE_PAGE_ORIGIN){var relY=(e.pageY-($control.get(0).getBoundingClientRect().top-WCP.ORIGIN.top))/$control.height();}
var value=relY<0?0:relY>1?1:relY;if(options.snap&&value<options.snapTolerance){value=0;}
else if(options.snap&&value>1-options.snapTolerance){value=1;}
if(options.snap&&value>0.5-options.snapTolerance&&value<0.5+options.snapTolerance){value=0.5;}
$cursor.css('top',(value*$control.height())+'px');if($control.hasClass('jQWCP-wRed')){this.setRgb(1-value,color.g,color.b);}
if($control.hasClass('jQWCP-wGreen')){this.setRgb(color.r,1-value,color.b);}
if($control.hasClass('jQWCP-wBlue')){this.setRgb(color.r,color.g,1-value);}
if($control.hasClass('jQWCP-wHue')){this.setHsv(value,color.s,color.v);}
if($control.hasClass('jQWCP-wSat')){this.setHsv(color.h,1-value,color.v);}
if($control.hasClass('jQWCP-wVal')){this.setHsv(color.h,color.s,1-value);}
if($control.hasClass('jQWCP-wAlpha')){this.setAlpha(1-value);}}};WCP.ColorPicker.prototype.getColor=function(){return this.color;};WCP.ColorPicker.prototype.getValue=function(format){var options=this.options;if(format==null){format=options.format;}
if(options.rounding>=0){this.color.a=Math.round(this.color.a*Math.pow(10,options.rounding))/Math.pow(10,options.rounding);}
return WCP.colorToStr(this.color,format);};WCP.ColorPicker.prototype.setValue=function(value,updateInput){var color=WCP.strToColor(value);if(!color)
return this;return this.setColor(color,updateInput);}
WCP.ColorPicker.prototype.setColor=function(color,updateInput){if(typeof color==="string"){return this.setValue(color,updateInput);}
else if(color.r!=null){return this.setRgba(color.r,color.g,color.b,color.a,updateInput);}
else if(color.h!=null){return this.setHsva(color.h,color.s,color.v,color.a,updateInput);}
else if(color.a!=null){return this.setAlpha(color.a,updateInput);}
return this;};WCP.ColorPicker.prototype.setRgba=function(r,g,b,a,updateInput){if(updateInput===undefined)updateInput=true;var color=this.color;color.r=r;color.g=g;color.b=b;if(a!=null){color.a=a;}
var hsv=WCP.rgbToHsv(r,g,b);color.h=hsv.h;color.s=hsv.s;color.v=hsv.v;this.updateSliders();this.redrawSliders();if(updateInput){this.updateInput();}
return this;};WCP.ColorPicker.prototype.setRgb=function(r,g,b,updateInput){return this.setRgba(r,g,b,null,updateInput);};WCP.ColorPicker.prototype.setHsva=function(h,s,v,a,updateInput){if(updateInput===undefined)updateInput=true;var color=this.color;color.h=h;color.s=s;color.v=v;if(a!=null){color.a=a;}
var rgb=WCP.hsvToRgb(h,s,v);color.r=rgb.r;color.g=rgb.g;color.b=rgb.b;this.updateSliders();this.redrawSliders();if(updateInput){this.updateInput();}
return this;};WCP.ColorPicker.prototype.setHsv=function(h,s,v,updateInput){return this.setHsva(h,s,v,null,updateInput);};WCP.ColorPicker.prototype.setAlpha=function(value,updateInput){if(updateInput===undefined)updateInput=true;this.color.a=value;this.updateSliders();this.redrawSliders();if(updateInput){this.updateInput();}
return this;};WCP.ColorPicker.prototype.show=function(){var input=this.input;var $input=$(input);var $widget=$(this.widget);var options=this.options;if(options.layout!="popup")
return;$widget.data('jQWCP.instance',this);$widget.stop(true,true);$widget.css({top:(input.getBoundingClientRect().top-WCP.ORIGIN.top+$input.outerHeight())+'px',left:(input.getBoundingClientRect().left-WCP.ORIGIN.left)+'px'});this.refreshWidget();this.redrawSliders();this.lastValue=input.value;$widget.fadeIn(options.animDuration);this.updateSliders();if(options.hideKeyboard){$input.blur();$(WCP.ColorPicker.overlay).show();}
if($widget.hasClass('jQWCP-mobile')){var scrollTop=$('html').scrollTop();var inputTop=input.getBoundingClientRect().top-WCP.ORIGIN.top;if(inputTop<scrollTop){$('html').animate({scrollTop:inputTop});}
else if(inputTop+$input.outerHeight()>scrollTop+window.innerHeight-$widget.outerHeight()){$('html').animate({scrollTop:inputTop+$input.outerHeight()-window.innerHeight+$widget.outerHeight()});}}};WCP.ColorPicker.prototype.hide=function(){var $widget=$(this.widget);if(this!=$widget.data('jQWCP.instance'))
return;$widget.fadeOut(this.options.animDuration);$(WCP.ColorPicker.overlay).hide();$widget.data('jQWCP.instance',null);};WCP.Handler={};WCP.Handler.input_focus_popup=function(e){var instance=$(this).data('jQWCP.instance');instance.show();if($(this).attr('readonly')==null){$(this).attr('readonly',true);setTimeout(function(){$(instance.input).removeAttr('readonly');});if(navigator.userAgent.match(/Android .* Firefox/)!=null){setTimeout(function(){$(instance.input).attr('readonly',true);$(instance.input).one('blur',function(){$(instance.input).removeAttr('readonly');});});}}};WCP.Handler.input_blur_popup=function(e){var instance=$(this).data('jQWCP.instance');if(instance.options.hideKeyboard)
return;instance.hide();if(instance.lastValue!=this.value){$(this).trigger('change');}};WCP.Handler.input_keyup=function(e){var instance=$(this).data('jQWCP.instance');var color=WCP.strToColor(this.value);if(color){instance.setColor(color,false);}};WCP.Handler.input_change=function(e){var instance=$(this).data('jQWCP.instance');var color=WCP.strToColor(this.value);if(instance.options.autoFormat&&color){instance.setColor(color,true);}
else if(instance.options.validate&&!color&&this.value!=''){this.value=instance.getValue();}};WCP.Handler.widget_focus_block=function(e){var instance=$(this).data('jQWCP.instance');var $input=$(instance.input);instance.lastValue=instance.input.value;$input.triggerHandler('focus');};WCP.Handler.widget_mousedown_popup=function(e){e.preventDefault();var instance=$(this).data('jQWCP.instance');var $input=$(instance.input);$input.off('focus.wheelColorPicker');$input.off('blur.wheelColorPicker');if($input.data('events')!=undefined){var blurEvents=$input.data('events').blur;}
else{var blurEvents=undefined;}
var suspendedEvents={blur:[]};if(blurEvents!=undefined){for(var i=0;i<blurEvents.length;i++){suspendedEvents.blur.push(blurEvents[i]);}}
$input.data('jQWCP.suspendedEvents',suspendedEvents);};WCP.Handler.widget_blur_block=function(e){var instance=$(this).data('jQWCP.instance');var $input=$(instance.input);if(instance.lastValue!=instance.input.value){$input.trigger('change');}
$input.triggerHandler('blur');};WCP.Handler.wheelCursor_mousedown=function(e){e.preventDefault();var $this=$(this);var $widget=$this.closest('.jQWCP-wWidget');var instance=$widget.data('jQWCP.instance');var $input=$(instance.input);$('body').data('jQWCP.activeControl',$this.parent().get(0));$input.trigger('sliderdown');};WCP.Handler.wheel_mousedown=function(e){e.preventDefault();var $this=$(this);var $widget=$this.closest('.jQWCP-wWidget');var instance=$widget.data('jQWCP.instance');var $input=$(instance.input);$('body').data('jQWCP.activeControl',$this.get(0));$input.trigger('sliderdown');instance.updateActiveControl(e);};WCP.Handler.slider_mousedown=function(e){e.preventDefault();var $this=$(this);var $widget=$this.closest('.jQWCP-wWidget');var instance=$widget.data('jQWCP.instance');var $input=$(instance.input);$('body').data('jQWCP.activeControl',$this.parent().get(0));$input.trigger('sliderdown');instance.updateActiveControl(e);};WCP.Handler.sliderCursor_mousedown=function(e){e.preventDefault();var $this=$(this);var $widget=$this.closest('.jQWCP-wWidget');var instance=$widget.data('jQWCP.instance');var $input=$(instance.input);$('body').data('jQWCP.activeControl',$this.parent().get(0));$input.trigger('sliderdown');};WCP.Handler.html_mouseup=function(e){var $control=$($('body').data('jQWCP.activeControl'));if($control.length){var $widget=$control.closest('.jQWCP-wWidget');}else{var $widget=$('#jQWCP-popup');}
var instance=$widget.data('jQWCP.instance');if(instance==null){return;}
var $input=$(instance.input);if(instance.options.layout=='popup'){if(!instance.options.hideKeyboard){$input.trigger('focus.jQWCP_DONT_TRIGGER_EVENTS');}
$input.on('focus.wheelColorPicker',WCP.Handler.input_focus_popup);$input.on('blur.wheelColorPicker',WCP.Handler.input_blur_popup);var suspendedEvents=$input.data('jQWCP.suspendedEvents');if(suspendedEvents!=undefined){var blurEvents=suspendedEvents.blur;for(var i=0;i<blurEvents.length;i++){$input.on('blur'+(blurEvents[i].namespace==''?'':'.'+blurEvents[i].namespace),blurEvents[i].handler);}}}
if($control.length!=0){if(e.type!='touchend'){instance.updateActiveControl(e);}
$('body').data('jQWCP.activeControl',null);$input.trigger('sliderup');}};WCP.Handler.html_mousemove=function(e){var $control=$($('body').data('jQWCP.activeControl'));if($control.length==0)
return;e.preventDefault();var $widget=$control.closest('.jQWCP-wWidget');var instance=$widget.data('jQWCP.instance');var $input=$(instance.input);instance.updateActiveControl(e);$input.trigger('slidermove');return false;};WCP.Handler.window_resize=function(e){var $widgets=$('body .jQWCP-wWidget.jQWCP-block');$widgets.each(function(){var instance=$(this).data('jQWCP.instance');instance.refreshWidget();instance.redrawSliders();});};WCP.Handler.overlay_click=function(e){if(WCP.ColorPicker.widget==null)
return;var $widget=$(WCP.ColorPicker.widget);var instance=$widget.data('jQWCP.instance');if(instance!=null){var $input=$(instance.input);if(instance.lastValue!=instance.input.value){$input.trigger('change');}
instance.hide();}};$(document).ready(function(){$('[data-wheelcolorpicker]').wheelColorPicker({htmlOptions:true});});(function(){if($.browser!=undefined&&$.browser.mozilla){$.fn.wheelColorPicker.defaults.quality=0.2;}
$(document).ready(function(){$('body').append('<div id="jQWCP-PageOrigin" style="position: absolute; top: 0; left: 0; height: 0; width: 0;"></div>');var origin=document.getElementById('jQWCP-PageOrigin').getBoundingClientRect();WCP.ORIGIN=origin;$(window).on('scroll.jQWCP_RelativePageOriginBugFix',function(){var origin=document.getElementById('jQWCP-PageOrigin').getBoundingClientRect();WCP.ORIGIN=origin;if(origin.left!=0||origin.top!=0){WCP.BUG_RELATIVE_PAGE_ORIGIN=true;}});});})();})(jQuery);