var prefs={data:{},load(name="prefs"){let cookieDecoded=decodeURIComponent(document.cookie).split(";");let cname=name+"=";for(let i=0;i<cookieDecoded.length;i++){let cook=cookieDecoded[parseInt(i,10)];while(cook[0]===" "){cook=cook.slice(1);}
if(cook.indexOf(cname)===0){this.data=JSON.parse(cook.substring(cname.length,cook.length));}}
return this.data;},save(expires,path){var d=expires||new Date(2100,2,2);var p=path||"/";document.cookie="prefs="+encodeURIComponent(JSON.stringify(this.data))
+";expires="+d.toUTCString()
+";path="+p;}};prefs.load();if(!prefs.data.hasOwnProperty("catsArr")){prefs.data.catsArr=[];}
if(!prefs.data.hasOwnProperty("catsShowArr")){prefs.data.catsShowArr=[];}
if(!prefs.data.hasOwnProperty("showNov")){prefs.data.showNov=[true,true,true];}
prefs.save();function raiseAlert(text="Text",type="alert"){let parent=document.createElement("div");parent.setAttribute("class","alert alert-dismissible fade show alert-"+type);parent.setAttribute("role","alert");let content=document.createElement("span");content.textContent=text;let close=document.createElement("button");close.setAttribute("class","close");close.setAttribute("data-dismiss","alert");close.setAttribute("aria-label","Close");let time=document.createElement("span");time.innerHTML="&times;";document.getElementById("inner-message").appendChild(parent);parent.appendChild(content);parent.appendChild(close);close.appendChild(time);setTimeout(function(){$(".alert").alert("close");},3000);}
function renderOcoins(paper){let ocoins={"ctx_ver":"Z39.88-2004","rft_val_fmt":encodeURIComponent("info:ofi/fmt:kev:mtx:journal"),"rft_id":encodeURIComponent(paper.ref_web),"rft_id":encodeURIComponent(paper.ref_doi),"rft.atitle":encodeURIComponent(paper.title),"rft.jtitle":encodeURIComponent("arXiv:"+paper.id+" ["+paper.cats[0]+"]"),"rft.date":encodeURIComponent(paper.date_up),"rft.artnum":encodeURIComponent(paper.id),"rft.genre":encodeURIComponent("preprint"),"rft.description":encodeURIComponent(paper.abstract),};ocoins=JSON.stringify(ocoins);ocoins=ocoins.replace(/\"/g,"");ocoins=ocoins.replace(/,/g,"&");ocoins=ocoins.replace(/:/g,"=");ocoins=ocoins.slice(1,ocoins.length-1);ocoins+=paper.author.map((au)=>{return"&rft.au="+encodeURIComponent(au);}).join();return ocoins;}
function renderAuthors(authors){let au=document.createElement("div");au.className="paper-au";if(authors.length>4){authors=authors.slice(0,5);authors.push("et al");}
au.textContent=authors.join(", ");return au;}
function rebderButtonsBase(content,pId){let btnPanel=document.createElement("div");btnPanel.className="btn-toolbar";btnPanel.id="btn-toolbar-"+pId;let btnGroup1=document.createElement("div");btnGroup1.className="btn-group mr-2";btnGroup1.role="group";btnPanel.appendChild(btnGroup1);let btnAbs=document.createElement("button");btnAbs.className="btn btn-primary";btnAbs.setAttribute("data-toggle","collapse");btnAbs.setAttribute("data-target","#abs-"+pId);btnAbs.id="btn-abs-"+pId;btnAbs.textContent="Abstract";btnGroup1.appendChild(btnAbs);let btnPdf=document.createElement("a");btnPdf.className="btn btn-primary";btnPdf.id="btn-pdf-"+pId;btnPdf.href=content.ref_pdf;btnPdf.target="_blank";btnPdf.innerHTML="<i class='fa fa-file-pdf-o' aria-hidden='true' style='font-weight:600'></i>&nbsp; PDF";let btnGroup2=document.createElement("div");btnGroup2.className="btn-group mr-2";btnGroup2.role="group";btnPanel.appendChild(btnGroup2);btnGroup2.appendChild(btnPdf);let btnArxiv=document.createElement("a");btnArxiv.className="btn btn-primary";btnArxiv.id="btn-arxiv-"+pId;btnArxiv.href=content.ref_web;btnArxiv.target="_blank";btnArxiv.textContent="arXiv";let btnGroup3=document.createElement("div");btnGroup3.className="btn-group mr-2";btnGroup3.relo="group";btnPanel.appendChild(btnGroup3);btnGroup3.appendChild(btnArxiv);return btnPanel;}
function renderPapersBase(content,pId){let paper=document.createElement("div");paper.className="paper";paper.id="paper-"+pId;document.getElementById("paper-list-content").appendChild(paper);let ocoinsSpan=document.createElement("span");ocoinsSpan.className="Z3988";ocoinsSpan.title=renderOcoins(content);paper.appendChild(ocoinsSpan);let title=document.createElement("div");title.className="paper-title";title.id="paper-title-"+pId;paper.appendChild(title);let number=document.createElement("span");number.id="paper-num-"+pId;number.textContent=String(pId+1);let titleText=document.createElement("span");titleText.textContent=". "+content.title;title.appendChild(number);title.appendChild(titleText);var tagPanel=document.createElement("div");tagPanel.className="tag-panel";tagPanel.id="tag-panel-"+pId;paper.appendChild(tagPanel);if("tags"in content&&content.tags.length>0){content.tags.forEach(function(tag){var tagDiv=document.createElement("div");tagDiv.className="tag-panel-item";tagDiv.style="background-color:"+TAGS[parseInt(tag,10)].color;tagDiv.textContent=TAGS[parseInt(tag,10)].name;tagPanel.appendChild(tagDiv);});}else{tagPanel.style="display: none";}
let au=renderAuthors(content.author);paper.appendChild(au);let date=document.createElement("div");date.id="paper-date-"+pId;date.className="paper-date";date.textContent=content.date_up;if(content.date_sub!==content.date_up){date.textContent+=" (v1: "+content.date_sub+")";}
paper.appendChild(date);if(content.ref_doi){let ref=document.createElement("div");ref.className="ref";let dark=document.createElement("span");dark.className="dark paper-doi";dark.textContent=" doi:";let light=document.createElement("span");light.className="light paper-doi";let link=document.createElement("a");link.href=content.ref_doi;link.target="_blank";link.textContent=content.ref_doi.split(".org/")[1];paper.appendChild(ref);ref.appendChild(dark);ref.appendChild(light);light.appendChild(link);}
let cat=document.createElement("div");cat.className="paper-cat";cat.innerHTML="[<strong>"+content.cats[0]+"</strong>";if(content.cats.length>1){cat.innerHTML+=", ";}
cat.innerHTML+=content.cats.slice(1).join(", ");cat.innerHTML+="]";paper.appendChild(cat);let btnPanel=rebderButtonsBase(content,pId);paper.appendChild(btnPanel);let abs=document.createElement("div");abs.className="collapse paper-abs";abs.id="abs-"+pId;abs.textContent=content.abstract;paper.appendChild(abs);return[paper,btnPanel];}
let PAPERS_TO_RENDER=20;let START=0;let DONE=false;var VISIBLE=0;function formateDate(date){let dateArray=date.toString().split(" ");return dateArray[2]+" "+dateArray[1]+" "+dateArray[3];}
function toggleVis(start=0){if(start===0){VISIBLE=0;}
for(let pId=start;pId<START+PAPERS_TO_RENDER;pId++){if(pId>=DATA.papers.length){break;}
let paper=DATA.papers[parseInt(pId,10)];let display=false;if(prefs.data.showNov[0]===true&&paper.nov===1||prefs.data.showNov[1]===true&&paper.nov===2||prefs.data.showNov[2]===true&&paper.nov===4){display=true;}else{display=false;}
if(display){for(let catId=0;catId<prefs.data.catsArr.length;catId++){let cat=prefs.data.catsArr[parseInt(catId,10)];if(prefs.data.catsShowArr[parseInt(catId,10)]&&paper.cats.includes(cat)){display=true;break;}else{display=false;}}}
if(display){document.getElementById("paper-"+pId).style["display"]="block";let number=document.getElementById("paper-num-"+pId);VISIBLE+=1;number.textContent=String(VISIBLE);}else{document.getElementById("paper-"+pId).style["display"]="none";}}
if(!DONE){scrollIfNeeded();}}
function renderTitle(){let title=document.getElementById("paper-list-title");let date=new Date();let dateNew=new Date();if(title.textContent.includes("today")){title.textContent+=": "+formateDate(date);}else if(title.textContent.includes("week")){let start=new Date(date.setDate(date.getDate()-date.getDay()+1));let end=new Date(dateNew.setDate(dateNew.getDate()+7-dateNew.getDay()));if((new Date()).getDay()===0){start=new Date(start.setDate(start.getDate()-7));end=new Date(dateNew.setDate(end.getDate()-7));}
title.textContent+=": "+formateDate(start)+" - "+formateDate(end);}else if(title.textContent.includes("month")){let end=new Date;let start=new Date(date.setDate(date.getDate()-date.getDate()+1));if(dateNew.getDate()===1){start=new Date(dateNew.setDate(dateNew.getDate()-1));}
title.textContent+=": "+formateDate(start)+" - "+formateDate(end);}}
function renderCats(){CATS.forEach((cat,num)=>{if(!prefs.data.catsArr.includes(cat)){prefs.data.catsArr.push(cat);prefs.data.catsShowArr.push(true);}
let parent=document.createElement("div");parent.className="d-flex menu-item";let form=document.createElement("div");form.className="form-check";var check=document.createElement("input");check.setAttribute("type","checkbox");check.id="check-cat-"+num;check.className="form-check-input check-cat";if(prefs.data.catsShowArr[prefs.data.catsArr.indexOf(cat)]){check.checked=true;}
check.onchange=function(){let number=event.target.getAttribute("id").split("-")[2];let cat=document.getElementById("cat-label-"+num).textContent;let index=prefs.data.catsArr.indexOf(cat);prefs.data.catsShowArr[parseInt(index,10)]=document.getElementById("check-cat-"+number).checked;prefs.save();toggleVis();};let catElement=document.createElement("label");catElement.className="form-check-label";catElement.id="cat-label-"+num;catElement.setAttribute("for","check-cat-"+num);catElement.textContent=cat;let counter=document.createElement("div");counter.className="ml-auto counter";counter.id="cat-count-"+num;counter.textContent="0";document.getElementById("cats").appendChild(parent);parent.appendChild(form);form.appendChild(check);form.appendChild(catElement);parent.appendChild(counter);});}
function renderTags(){TAGS.forEach((tag,num)=>{let parent=document.createElement("div");parent.className="d-flex justify-content-between align-items-center";let tagElement=document.createElement("div");tagElement.className="tag-label";tagElement.id="tag-label-"+num;tagElement.style="background-color: "+tag.color;tagElement.textContent=tag.name;let counter=document.createElement("div");counter.className="counter";counter.id="tag-count-"+num;counter.textContent="0";document.getElementById("tags").appendChild(parent);parent.appendChild(tagElement);parent.appendChild(counter);});if(parseTex){MathJax.typesetPromise();}}
function renderNov(){prefs.data.showNov.forEach((show,num)=>{document.getElementById("check-nov-"+num).checked=show;});}
function renderCounters(){let nCats=CATS.length;for(let catId=0;catId<nCats;catId++){document.getElementById("cat-count-"+catId).textContent=DATA.ncat[parseInt(catId,10)];}
for(let novId=0;novId<3;novId++){document.getElementById("nov-count-"+novId).textContent=DATA.nnov[parseInt(novId,10)];}
let nTags=TAGS.length;for(let tagId=0;tagId<nTags;tagId++){document.getElementById("tag-count-"+tagId).textContent=DATA.ntag[parseInt(tagId,10)];}}
function addBookmark(event){if(!event.target.id.includes("btn-book")&&!event.target.id.includes("a-icon")){return;}
let url="add_bm";let num=event.target.getAttribute("id").split("-")[2];let paper=DATA.papers[parseInt(num,10)];$.post(url,{"title":paper.title,"paper_id":paper.id.split("v")[0],"author":paper.author,"date_up":paper.date_up,"abstract":paper.abstract,"ref_pdf":paper.ref_pdf,"ref_web":paper.ref_web,"ref_doi":paper.ref_doi,"cats":paper.cats}).done(function(data,textStatus,jqXHR){let status=jqXHR.status;if(status===200){raiseAlert("Paper has been already saved","success");}
if(status===201){raiseAlert("Paper has been added","success");}}).fail(function(){raiseAlert("Paper is not saved due to server error","danger");});}
function renderPapers(){for(let pId=START;pId<START+PAPERS_TO_RENDER;pId++){if(DATA.papers.length<=pId){break;}
let content=DATA.papers[parseInt(pId,10)];let paperBase=renderPapersBase(content,pId);let btnPanel=paperBase[1];let btnBook=document.createElement("button");btnBook.className="btn btn-primary";btnBook.id="btn-book-"+pId;btnBook.innerHTML="<i class='fa fa-bookmark' aria-hidden='true' id='a-icon-"+pId+"'></i>";btnBook.onclick=addEventListener("click",addBookmark);let btnGroup4=document.createElement("div");btnGroup4.className="btn-group mr-2";btnGroup4.role="group";btnPanel.appendChild(btnGroup4);btnGroup4.appendChild(btnBook);}
toggleVis(START);if(parseTex){MathJax.typesetPromise();}
if(!DONE){scrollIfNeeded();}}
function sortFunction(a,b,order=true){return order?a-b:b-a;}
function sortPapers(){$("#paper-list-content").empty();START=0;let sortMethod=$("#sort-sel").val();if(sortMethod.includes("tag")){DATA.papers.sort((a,b)=>{if(b.tags.length===0||a.tags.length===0){return-1;}
return sortFunction(a.tags[0],b.tags[0],sortMethod==="tag-as"?true:false);});}
if(sortMethod.includes("date")){DATA.papers.sort((a,b)=>{let aDate=new Date(a.date_up);let bDate=new Date(b.date_up);return sortFunction(aDate,bDate,sortMethod==="date-des"?true:false);});}
if(sortMethod.includes("cat")){DATA.papers.sort((a,b)=>{let catA="";let catB="";for(let id=0;id<a.cats.length;id++){if(CATS.includes(a.cats[parseInt(id,10)])){catA=a.cats[parseInt(id,10)];break;}}
for(let id=0;id<b.cats.length;id++){if(CATS.includes(b.cats[parseInt(id,10)])){catB=b.cats[parseInt(id,10)];break;}}
return sortFunction(CATS.indexOf(catA),CATS.indexOf(catB),sortMethod==="cat-as"?true:false);});}
if(sortMethod.includes("nov")){DATA.papers.sort((a,b)=>{let novA=a.nov;let novB=b.nov;return sortFunction(novA,novB,sortMethod==="nov-des"?true:false);});}}
$("#sort-sel").change(()=>{$("#sorting-proc").css("display","block");sortPapers();setTimeout(function(){renderPapers();$("#sorting-proc").css("display","none");if(parseTex){MathJax.typesetPromise();}},0);});function scrollIfNeeded(){if(START>DATA.papers.length){DONE=true;document.getElementById("loading-papers").style["display"]="none";document.getElementById("done-papers").style["display"]="block";return;}
var scrollTop=window.scrollY;var windowHeight=window.innerHeight;var bodyHeight=document.body.clientHeight-windowHeight;var scrollPercentage=(scrollTop/bodyHeight);if(scrollPercentage>0.9||bodyHeight<0){START+=PAPERS_TO_RENDER;document.getElementById("loading-papers").style["display"]="block";renderPapers();}}
document.getElementById("filter-button").onclick=function(){if(document.getElementById("menu-col").classList.contains("d-none")){document.getElementById("menu-col").classList.remove("d-none");document.getElementById("menu-main").classList.remove("ml-auto");}else{document.getElementById("menu-col").classList.add("d-none");document.getElementById("menu-main").classList.add("ml-auto");}};function addAnchors(){var anchors=document.getElementsByClassName("check-nov");for(let i=0;i<anchors.length;i++){let anchor=anchors[i];anchor.onchange=function(event){let number=event.target.getAttribute("id").split("-")[2];prefs.data.showNov[parseInt(number,10)]=document.getElementById("check-nov-"+number).checked;prefs.save();toggleVis();}}
anchors=document.getElementsByClassName("item-nov");for(let i=0;i<anchors.length;i++){let anchor=anchors[parseInt(i,10)];anchor.onclick=function(event){let number=event.target.getAttribute("id").split("-")[1];document.getElementById("check-nov-"+number).click();}}}
window.onload=function(){var url=document.location.href;url=url.replace("papers","data");$.get(url).done(function(data){document.getElementById("loading-papers").style["display"]="none";DATA=data;renderCounters();renderPapers();$("#sort-block").css("display","block");}).fail(function(jqXHR){if(jqXHR.status===404){$("#loading-papers").text("Paper source website is not responding. Is it down?");}else if(jqXHR.status===400){$("#loading-papers").text("Paper source website response with no papers for your request");}else{$("#loading-papers").text("Oooops, arxivtag experienced an internal error processing your papers. We are working on fixing that. Please try later.");}});renderTitle();renderNov();renderCats();renderTags();addAnchors();};window.onscroll=function(){if(!DONE){scrollIfNeeded();}};